<!DOCTYPE html>
<html class="direction--ltr"lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>AWS Amplify Android 오픈소스 기여하기 | onseok.log</title>
<meta name="generator" content="Jekyll v4.4.1" />
<meta property="og:title" content="AWS Amplify Android 오픈소스 기여하기" />
<meta name="author" content="onseok" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="AWS Amplify는 모바일 및 프런트엔드 개발자가 AWS에서 안전하고 확장 가능한 풀스택 애플리케이션을 구축하고 배포할 수 있도록 지원하는 제품입니다. 회사에서 서비스하고 있는 프로젝트에서 S3로 로그 파일을 주기적으로 업로드하는 기능을 구현하고 꾸준히 모니터링하였는데, 여러 Android 기기에서 java.lang.OutOfMemoryError 오류가 반복적으로 발생하는 것을 발견했습니다." />
<meta property="og:description" content="AWS Amplify는 모바일 및 프런트엔드 개발자가 AWS에서 안전하고 확장 가능한 풀스택 애플리케이션을 구축하고 배포할 수 있도록 지원하는 제품입니다. 회사에서 서비스하고 있는 프로젝트에서 S3로 로그 파일을 주기적으로 업로드하는 기능을 구현하고 꾸준히 모니터링하였는데, 여러 Android 기기에서 java.lang.OutOfMemoryError 오류가 반복적으로 발생하는 것을 발견했습니다." />
<link rel="canonical" href="https://onseok.github.io/2025/02/25/aws-amplify-android.html" />
<meta property="og:url" content="https://onseok.github.io/2025/02/25/aws-amplify-android.html" />
<meta property="og:site_name" content="onseok.log" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2025-02-25T00:00:00+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="AWS Amplify Android 오픈소스 기여하기" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"onseok"},"dateModified":"2025-02-25T00:00:00+00:00","datePublished":"2025-02-25T00:00:00+00:00","description":"AWS Amplify는 모바일 및 프런트엔드 개발자가 AWS에서 안전하고 확장 가능한 풀스택 애플리케이션을 구축하고 배포할 수 있도록 지원하는 제품입니다. 회사에서 서비스하고 있는 프로젝트에서 S3로 로그 파일을 주기적으로 업로드하는 기능을 구현하고 꾸준히 모니터링하였는데, 여러 Android 기기에서 java.lang.OutOfMemoryError 오류가 반복적으로 발생하는 것을 발견했습니다.","headline":"AWS Amplify Android 오픈소스 기여하기","mainEntityOfPage":{"@type":"WebPage","@id":"https://onseok.github.io/2025/02/25/aws-amplify-android.html"},"url":"https://onseok.github.io/2025/02/25/aws-amplify-android.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/style.css">
  <link rel="icon" type="image/png" href="/assets/favicon.png" />
  <link rel="stylesheet" href="/assets/css/magnific-popup.css"><link type="application/atom+xml" rel="alternate" href="https://onseok.github.io/feed.xml" title="onseok.log" /><script src="https://code.jquery.com/jquery-3.2.0.min.js"></script> 
  <script src="/assets/js/jquery.magnific-popup.js"></script>
</head>
<body><div class="site-header">
  <div class="wrapper">
    <a class="site-title" rel="author" href="/">onseok.log<b class="command_prompt"></b><b class="blinking_cursor">_</b></a>
    <span class="social_links">
        
        
        <a class="color-yellow-hover" href="https://github.com/onseok"><i class="fab fa-github-square"></i></a>
        
        
        
        <a class="color-blue-hover" href="https://www.linkedin.com/in/onseok"><i class="fab fa-linkedin"></i></a>
        
        
    </span>
  </div>
</div>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        
  <div class="author-box">


<img src="
    https://github.com/onseok.png
" class="author-avatar" alt="Avatar" />
<div class="description">생각을 컴파일하기<br>
배움을 배포하기
</div>

</div>


<div class="post">
  <h1 class="post-title">AWS Amplify Android 오픈소스 기여하기</h1>
  
  <div class="post-tags">
      
      <a class="tag" href="/tag/opensource/">opensource</a>
      
  </div>
  
  <div class="post-date">
    Published on 25 Feb 2025
    
  </div>
  
  <p>AWS Amplify는 모바일 및 프런트엔드 개발자가 AWS에서 안전하고 확장 가능한 풀스택 애플리케이션을 구축하고 배포할 수 있도록 지원하는 제품입니다. 회사에서 서비스하고 있는 프로젝트에서 S3로 로그 파일을 주기적으로 업로드하는 기능을 구현하고 꾸준히 모니터링하였는데, 여러 Android 기기에서 <a href="https://docs.oracle.com/javase/8/docs/technotes/guides/troubleshoot/memleaks002.html">java.lang.OutOfMemoryError</a> 오류가 반복적으로 발생하는 것을 발견했습니다.</p>

<h3 id="원인을-분석해보자">원인을 분석해보자</h3>
<p>수집된 크래시 리포트를 요약하면 다음과 같았습니다.</p>
<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Fatal Exception: java.lang.OutOfMemoryError: Failed to allocate a 8388620 byte allocation with 8388608 free bytes and 19MB until OOM
       at java.util.IdentityHashMap.resize(IdentityHashMap.java:476)
       at java.util.IdentityHashMap.put(IdentityHashMap.java:452)
       ...
       at com.amplifyframework.storage.s3.transfer.TransferWorkerObserver$attachObserver$2.invokeSuspend(TransferWorkerObserver.kt:199)
</code></pre></div></div>

<p><a href="https://github.com/aws-amplify/amplify-android/blob/main/aws-storage-s3/src/main/java/com/amplifyframework/storage/s3/transfer/TransferWorkerObserver.kt">TransferWorkerObserver</a> 클래스에서 동일한 전송 태그에 대해 <code class="language-plaintext highlighter-rouge">LiveData.observeForever()</code>가 중복 호출되며, 여러 관찰자가 등록된 것으로 보였고, 이는 <code class="language-plaintext highlighter-rouge">LiveData</code> 내부의 <a href="https://docs.oracle.com/javase/8/docs/api/java/util/IdentityHashMap.html">IdentityHashMap</a>이 과도하게 커져 메모리 할당에 실패하게 만들고, 특히 <code class="language-plaintext highlighter-rouge">Room</code> 라이브러리의 <a href="https://developer.android.com/reference/androidx/room/InvalidationTracker">InvalidationTracker</a>와 연계된 <code class="language-plaintext highlighter-rouge">LiveData</code> 사용으로 메모리 사용량이 더 증가한 것으로 판단하였습니다.</p>

<h3 id="이슈-등록하기">이슈 등록하기</h3>
<p>저는 먼저 이 문제를 공유하기 위해 템플릿에 맞추어 <a href="https://github.com/aws-amplify/amplify-android/issues/2840">이슈</a>를 등록해주었습니다.</p>

<p>다만, <strong>보안상</strong> 회사 코드를 전부 스니펫에 첨부할 수는 없었기 때문에 민감한 코드는 전부 제거하고 핵심 로직만 다시 재작성하였습니다. 이슈란에 첨부한 코드 스니펫은 다음과 같았습니다.</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@HiltWorker</span>
<span class="kd">class</span> <span class="nc">LogUploadWorker</span> <span class="nd">@AssistedInject</span> <span class="k">constructor</span><span class="p">(</span>
    <span class="nd">@Assisted</span> <span class="k">private</span> <span class="kd">val</span> <span class="py">appContext</span><span class="p">:</span> <span class="nc">Context</span><span class="p">,</span>
    <span class="nd">@Assisted</span> <span class="n">workerParams</span><span class="p">:</span> <span class="nc">WorkerParameters</span><span class="p">,</span>
    <span class="nd">@Dispatcher</span><span class="p">(</span><span class="nc">IO</span><span class="p">)</span> <span class="k">private</span> <span class="kd">val</span> <span class="py">ioDispatcher</span><span class="p">:</span> <span class="nc">CoroutineDispatcher</span>
<span class="p">)</span> <span class="p">:</span> <span class="nc">CoroutineWorker</span><span class="p">(</span><span class="n">appContext</span><span class="p">,</span> <span class="n">workerParams</span><span class="p">)</span> <span class="p">{</span>

    <span class="k">override</span> <span class="k">suspend</span> <span class="k">fun</span> <span class="nf">getForegroundInfo</span><span class="p">():</span> <span class="nc">ForegroundInfo</span> <span class="p">=</span>
        <span class="n">appContext</span><span class="p">.</span><span class="nf">logSyncForegroundInfo</span><span class="p">()</span>

    <span class="k">override</span> <span class="k">suspend</span> <span class="k">fun</span> <span class="nf">doWork</span><span class="p">():</span> <span class="nc">Result</span> <span class="p">=</span> <span class="nf">withContext</span><span class="p">(</span><span class="n">ioDispatcher</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">try</span> <span class="p">{</span>
            <span class="kd">val</span> <span class="py">externalFilesDirPath</span> <span class="p">=</span> <span class="n">inputData</span><span class="p">.</span><span class="nf">getString</span><span class="p">(</span><span class="s">"externalFilesDirPath"</span><span class="p">)</span>
            <span class="kd">val</span> <span class="py">externalFilesDir</span> <span class="p">=</span> <span class="n">externalFilesDirPath</span><span class="o">?.</span><span class="nf">let</span> <span class="p">{</span> <span class="nc">File</span><span class="p">(</span><span class="n">it</span><span class="p">)</span> <span class="p">}</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">externalFilesDir</span> <span class="p">!=</span> <span class="k">null</span> <span class="p">&amp;&amp;</span> <span class="n">externalFilesDir</span><span class="p">.</span><span class="nf">exists</span><span class="p">())</span> <span class="p">{</span>
                <span class="nf">uploadLogFiles</span><span class="p">(</span><span class="n">externalFilesDir</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">e</span><span class="p">:</span> <span class="nc">Exception</span><span class="p">)</span> <span class="p">{</span>
            <span class="nc">Timber</span><span class="p">.</span><span class="nf">e</span><span class="p">(</span><span class="s">"Log upload exception: ${e.message}"</span><span class="p">)</span>
            <span class="nc">Result</span><span class="p">.</span><span class="nf">retry</span><span class="p">()</span>
        <span class="p">}</span>
        <span class="nc">Result</span><span class="p">.</span><span class="nf">success</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="nd">@OptIn</span><span class="p">(</span><span class="nc">ExperimentalCoroutinesApi</span><span class="o">::</span><span class="k">class</span><span class="p">,</span> <span class="nc">FlowPreview</span><span class="o">::</span><span class="k">class</span><span class="p">)</span>
    <span class="k">private</span> <span class="k">suspend</span> <span class="k">fun</span> <span class="nf">uploadLogFiles</span><span class="p">(</span><span class="n">externalFilesDir</span><span class="p">:</span> <span class="nc">File</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">val</span> <span class="py">curFiles</span> <span class="p">=</span> <span class="n">externalFilesDir</span><span class="p">.</span><span class="nf">listFiles</span><span class="p">()</span><span class="o">?.</span><span class="nf">filter</span> <span class="p">{</span> <span class="n">file</span> <span class="p">-&gt;</span>
            <span class="nc">System</span><span class="p">.</span><span class="nf">currentTimeMillis</span><span class="p">()</span> <span class="p">-</span> <span class="n">file</span><span class="p">.</span><span class="nf">lastModified</span><span class="p">()</span> <span class="p">&lt;</span> <span class="nc">TWO_WEEK_TIME_MILLIS</span>
        <span class="p">}</span><span class="o">?.</span><span class="nf">sortedByDescending</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="nf">lastModified</span><span class="p">()</span> <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">curFiles</span><span class="p">.</span><span class="nf">isNullOrEmpty</span><span class="p">())</span> <span class="p">{</span>
            <span class="nc">Timber</span><span class="p">.</span><span class="nf">i</span><span class="p">(</span><span class="s">"No log files or directory found."</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="p">}</span>
        
        <span class="kd">val</span> <span class="py">environmentPrefix</span> <span class="p">=</span> <span class="k">if</span> <span class="p">(</span><span class="nc">BuildConfig</span><span class="p">.</span><span class="nc">DEBUG</span><span class="p">)</span> <span class="s">"debug"</span> <span class="k">else</span> <span class="s">"release"</span>
        <span class="kd">val</span> <span class="py">dateFormat</span> <span class="p">=</span> <span class="nc">SimpleDateFormat</span><span class="p">(</span><span class="s">"yyyy-MM-dd"</span><span class="p">,</span> <span class="nc">Locale</span><span class="p">.</span><span class="nf">getDefault</span><span class="p">())</span>

        <span class="n">curFiles</span><span class="p">.</span><span class="nf">forEach</span> <span class="p">{</span> <span class="n">file</span> <span class="p">-&gt;</span>
            <span class="kd">val</span> <span class="py">date</span> <span class="p">=</span> <span class="n">dateFormat</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="nc">Date</span><span class="p">(</span><span class="n">file</span><span class="p">.</span><span class="nf">lastModified</span><span class="p">()))</span>
            <span class="kd">val</span> <span class="py">fileIndex</span> <span class="p">=</span> <span class="n">file</span><span class="p">.</span><span class="n">name</span><span class="p">.</span><span class="nf">substringBefore</span><span class="p">(</span><span class="s">"_logs.txt"</span><span class="p">).</span><span class="nf">takeLastWhile</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="nf">isDigit</span><span class="p">()</span> <span class="p">}</span>
            <span class="kd">val</span> <span class="py">key</span> <span class="p">=</span> <span class="s">"$environmentPrefix/sample/$date/log$fileIndex.txt"</span>

            <span class="k">try</span> <span class="p">{</span>
                <span class="kd">val</span> <span class="py">result</span> <span class="p">=</span> <span class="nc">Amplify</span><span class="p">.</span><span class="nc">Storage</span><span class="p">.</span><span class="nf">uploadFile</span><span class="p">(</span>
                    <span class="nc">StoragePath</span><span class="p">.</span><span class="nf">fromString</span><span class="p">(</span><span class="s">"public/$key"</span><span class="p">),</span>
                    <span class="n">file</span>
                <span class="p">).</span><span class="nf">result</span><span class="p">()</span>
                <span class="nc">Timber</span><span class="p">.</span><span class="nf">i</span><span class="p">(</span><span class="s">"Log file upload successful: ${result.path}"</span><span class="p">)</span>
            <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">error</span><span class="p">:</span> <span class="nc">Exception</span><span class="p">)</span> <span class="p">{</span>
                <span class="nc">Timber</span><span class="p">.</span><span class="nf">e</span><span class="p">(</span><span class="s">"Log file upload failed: ${error.message} - ${error.cause}"</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">companion</span> <span class="k">object</span> <span class="p">{</span>
        <span class="k">private</span> <span class="k">const</span> <span class="kd">val</span> <span class="py">TWO_WEEK_TIME_MILLIS</span> <span class="p">=</span> <span class="mi">14</span> <span class="p">*</span> <span class="mi">24</span> <span class="p">*</span> <span class="mi">60</span> <span class="p">*</span> <span class="mi">60</span> <span class="p">*</span> <span class="mi">1000L</span>

        <span class="k">fun</span> <span class="nf">startUpUploadWork</span><span class="p">(</span>
            <span class="n">externalFilesDirPath</span><span class="p">:</span> <span class="nc">File</span><span class="p">?</span>
        <span class="p">)</span> <span class="p">=</span> <span class="nc">PeriodicWorkRequestBuilder</span><span class="p">&lt;</span><span class="nc">LogUploadWorker</span><span class="p">&gt;(</span>
            <span class="mi">1</span><span class="p">,</span> <span class="nc">TimeUnit</span><span class="p">.</span><span class="nc">HOURS</span><span class="p">,</span>
            <span class="mi">5</span><span class="p">,</span> <span class="nc">TimeUnit</span><span class="p">.</span><span class="nc">MINUTES</span>
        <span class="p">)</span>
            <span class="p">.</span><span class="nf">setConstraints</span><span class="p">(</span><span class="nc">LogSyncConstraints</span><span class="p">)</span>
            <span class="p">.</span><span class="nf">setBackoffCriteria</span><span class="p">(</span>
                <span class="nc">BackoffPolicy</span><span class="p">.</span><span class="nc">LINEAR</span><span class="p">,</span>
                <span class="nc">MIN_BACKOFF_MILLIS</span><span class="p">,</span>
                <span class="nc">TimeUnit</span><span class="p">.</span><span class="nc">MILLISECONDS</span>
            <span class="p">)</span>
            <span class="p">.</span><span class="nf">setInputData</span><span class="p">(</span>
                <span class="nc">Data</span><span class="p">.</span><span class="nc">Builder</span><span class="p">()</span>
                    <span class="p">.</span><span class="nf">putString</span><span class="p">(</span><span class="s">"externalFilesDirPath"</span><span class="p">,</span> <span class="n">externalFilesDirPath</span><span class="o">?.</span><span class="n">absolutePath</span><span class="p">)</span>
                    <span class="p">.</span><span class="nf">build</span><span class="p">()</span>
            <span class="p">)</span>
            <span class="p">.</span><span class="nf">build</span><span class="p">()</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>간단하게 위 스니펫의 로직을 설명하면, 먼저 로그 파일 디렉터리 경로를 기반으로 파일 객체를 생성하고, <strong>2주</strong> 이내에 수정된 파일들을 필터링하며, 최근 수정된 순서로 정렬한 뒤, 예외가 발생했을 때에는 <code class="language-plaintext highlighter-rouge">선형 재시도</code> 정책을 따르도록 설정해주었고, 각 파일에 대해 <code class="language-plaintext highlighter-rouge">빌드타입</code>에 따른 정보와, 파일의 수정 날짜, 파일 이름의 인덱스를 조합하여 AWS S3에 저장할 키를 구성하고, 이후 파일을 업로드하고 그 결과를 Timber 로그로 남기는 흐름입니다. 이 작업은 <code class="language-plaintext highlighter-rouge">주기적으로 실행되는 작업</code>에 해당하므로 <a href="https://developer.android.com/topic/libraries/architecture/workmanager?hl=ko">Workmanager</a>의 <a href="https://developer.android.com/reference/androidx/work/PeriodicWorkRequest.Builder">PeriodicWorkRequest.Builder</a>를 활용하였습니다.</p>

<p><img src="/public/media/2025-02-25/aws-amplify-issue-comment.png" alt="aws-amplify-issue-comment" /></p>

<p>이후 해당 이슈란의 코멘트를 통해 메인테이너분들과 이슈의 발생 빈도와 문제 발생 기기의 스펙 정보들을 요청받았고, 당시에는 <a href="https://github.com/aws-amplify/amplify-android">aws-amplify/amplify-android</a> 라이브러리 자체의 문제라기보다는 <code class="language-plaintext highlighter-rouge">내가 구현한 코드에 문제가 있었나?</code>, <code class="language-plaintext highlighter-rouge">OOM이 발생하지 않도록 더 최적화 할수는 없는가?</code>라고 고민을 하였고, 이를 해결하기 위해 아래의 개선작업들을 진행했습니다.</p>

<ul>
  <li>로그 파일 리스트를 즉시 모두 메모리에 로드하지 않고, 필요한 시점에만 File 객체를 생성하도록 개선하기</li>
  <li>14일 이상된 오래된 로그 파일들을 주기적으로 삭제하여 처리해야할 로그 파일 수 자체를 줄이기</li>
</ul>

<p>하지만, 이러한 노력에도 불구하고 여전히 주기적으로 OOM 오류들이 수집되었습니다.</p>

<h3 id="직접-수정해보자">직접 수정해보자</h3>
<p>오픈소스와 관련된 활동을 한다면, 라이선스 규정을 잘 준수해야 합니다. 또한 오픈소스 프로젝트에 컨트리뷰션을 하기 전에는 <code class="language-plaintext highlighter-rouge">CONTRIBUTING.md</code> 파일을 꼼꼼하게 읽어 가이드라인을 잘 준수할 수 있도록 해야합니다.</p>

<p>저는 직접 수정해보기로 마음먹었습니다. 수집된 크래시 리포트를 다시 분석하여 코드를 수정한 뒤 PR을 생성하였고, 수정된 코드는 아래와 같습니다.</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">java.util.concurrent.ConcurrentHashMap</span>

<span class="k">private</span> <span class="kd">val</span> <span class="py">observedTags</span> <span class="p">=</span> <span class="nc">ConcurrentHashMap</span><span class="p">.</span><span class="n">newKeySet</span><span class="p">&lt;</span><span class="nc">String</span><span class="p">&gt;()</span>

<span class="k">private</span> <span class="k">suspend</span> <span class="k">fun</span> <span class="nf">attachObserver</span><span class="p">(</span><span class="n">tag</span><span class="p">:</span> <span class="nc">String</span><span class="p">)</span> <span class="p">{</span>
    <span class="nf">withContext</span><span class="p">(</span><span class="nc">Dispatchers</span><span class="p">.</span><span class="nc">Main</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(!</span><span class="n">observedTags</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="n">tag</span><span class="p">))</span> <span class="k">return</span><span class="nd">@withContext</span>
        <span class="kd">val</span> <span class="py">liveData</span> <span class="p">=</span> <span class="n">workManager</span><span class="p">.</span><span class="nf">getWorkInfosByTagLiveData</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
        <span class="n">liveData</span><span class="p">.</span><span class="nf">observeForever</span><span class="p">(</span><span class="k">this</span><span class="nd">@TransferWorkerObserver</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">private</span> <span class="k">suspend</span> <span class="k">fun</span> <span class="nf">removeObserver</span><span class="p">(</span><span class="n">tag</span><span class="p">:</span> <span class="nc">String</span><span class="p">)</span> <span class="p">{</span>
    <span class="nf">withContext</span><span class="p">(</span><span class="nc">Dispatchers</span><span class="p">.</span><span class="nc">Main</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(!</span><span class="n">observedTags</span><span class="p">.</span><span class="nf">remove</span><span class="p">(</span><span class="n">tag</span><span class="p">))</span> <span class="k">return</span><span class="nd">@withContext</span>
        <span class="n">workManager</span><span class="p">.</span><span class="nf">getWorkInfosByTagLiveData</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
            <span class="p">.</span><span class="nf">removeObserver</span><span class="p">(</span><span class="k">this</span><span class="nd">@TransferWorkerObserver</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>AWS Amplify Storage 모듈의 <a href="https://github.com/aws-amplify/amplify-android/blob/main/aws-storage-s3/src/main/java/com/amplifyframework/storage/s3/transfer/TransferWorkerObserver.kt">TransferWorkerObserver</a> 클래스에 중복 관찰자 등록을 방지하는 로직을 추가하였고, <a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/ConcurrentHashMap.html">ConcurrentHashMap</a>은 <code class="language-plaintext highlighter-rouge">thread-safe</code>하며, <code class="language-plaintext highlighter-rouge">ConcurrentHashMap.newKeySet()</code>은 <code class="language-plaintext highlighter-rouge">Set</code> 인터페이스를 제공해주는데, 태그가 이미 존재하면 <code class="language-plaintext highlighter-rouge">add()</code>는 <code class="language-plaintext highlighter-rouge">false</code>를 반환하고, 얼리 리턴을 통해 함수를 종료합니다. 마찬가지로 <code class="language-plaintext highlighter-rouge">remove()</code>는 태그가 <code class="language-plaintext highlighter-rouge">observedTags</code>에 없으면 false를 반환하고 함수를 종료시킵니다. 이를 통해 불필요한 중복된 태그 등록을 방지할 수 있도록 수정하였습니다.</p>

<h3 id="뿌듯한-결과">뿌듯한 결과</h3>
<p><img src="/public/media/2025-02-25/aws-amplify-approve-comment.png" alt="aws-amplify-approve-comment" /></p>

<p>메인테이너분으로부터 좋은 아이디어라는 의견과 함께 몇 가지 제안사항들을 수정한 뒤에 최종 승인이 되었고, <a href="https://github.com/aws-amplify/amplify-android/releases/tag/release_v2.27.1">2.27.1</a> 버전에 해당 작업이 반영되어 릴리즈 되었습니다 🎉</p>

<p>이러한 경험을 통해서 회사 프로젝트에서 사용중인 오픈소스 라이브러리 오류를 발견하면 적극적으로 PR을 올려 기여하고 문제를 수정하는 것이 중요하다고 느꼈고, 자주 사용했지만 몰랐던 라이브러리의 내부 동작을 살펴보는 경험을 하게 되었습니다.</p>

<h3 id="아쉬웠던-점-그리고-반성">아쉬웠던 점, 그리고 반성</h3>

<blockquote>
  <p>만약 Heap Dump를 더욱 끈질기게 분석했더라면, 문제의 근본 원인을 더 빠르게 파악하고 보다 더 근거있는 이슈 트래킹에 큰 도움이 되었지 않았을까?</p>
</blockquote>

</div>

<div class="comments">
    <script src="https://utteranc.es/client.js"
            repo="onseok/onseok.github.io"
            issue-term="pathname"
            theme="dark-blue"
            crossorigin="anonymous"
            async>
    </script>
  </div>






  
  <h2>all tags</h2>
  <div class="tag-cloud"><a href="/tag/opensource/" class="set-5">opensource</a></div>
  




<script>
  let i = 0;
  const text = '';
  const speed = parseInt('50');
  
  function typeWriter() {
    if (i < text.length) {
      document.getElementById('animated-post-description').innerHTML += text.charAt(i);
      i++;
      setTimeout(typeWriter, speed);
    }
  }

  document.getElementById('animated-post-description').style.display = 'initial';
  typeWriter();

  // Image modal
  var $imgs = [];
  $('img').each(function(idx) {
    var obj = {
      src: $(this).attr('src')
    }
    $imgs.push(obj);
    var elem = $(this);
    $(this).click(function() {
      $('.modal').magnificPopup('open', idx);
    });
  });

  $('.modal').magnificPopup({
    items: $imgs,
    type: 'image',
    closeOnContentClick: true,
    mainClass: 'mfp-img-mobile',
    image: {
      verticalFit: true
    }
    
  });
</script>
      </div>
    </main><footer class="site-footer">
  <div class="wrapper">
    <div class="credits"><a href="https://github.com/bitbrain/jekyll-dash">dash</a> theme for Jekyll by <a href="https://github.com/bitbrain">bitbrain</a> made with <i class="fas fa-heart"></i><div class="toggleWrapper">
    <input type="checkbox" class="dn" id="theme-toggle" onclick="modeSwitcher()" checked />
    <label for="theme-toggle" class="toggle">
    <span class="toggle__handler">
      <span class="crater crater--1"></span>
      <span class="crater crater--2"></span>
      <span class="crater crater--3"></span>
    </span>
        <span class="star star--1"></span>
        <span class="star star--2"></span>
        <span class="star star--3"></span>
        <span class="star star--4"></span>
        <span class="star star--5"></span>
        <span class="star star--6"></span>
    </label>
</div>
<script type="text/javascript">
const theme = localStorage.getItem('theme');

if (theme === "light") {
    document.documentElement.setAttribute('data-theme', 'light');
} else {
    document.documentElement.setAttribute('data-theme', 'dark');
}
const userPrefers = getComputedStyle(document.documentElement).getPropertyValue('content');

function activateDarkTheme() {
    document.getElementById('theme-toggle').checked = true;
    document.documentElement.setAttribute('data-theme', 'dark');
    document.documentElement.classList.add('theme--dark');
    document.documentElement.classList.remove('theme--light');
	document.getElementById("theme-toggle").className = 'light';
	window.localStorage.setItem('theme', 'dark');
}

function activateLightTheme() {
    document.getElementById('theme-toggle').checked = false;
    document.documentElement.setAttribute('data-theme', 'light');
    document.documentElement.classList.add('theme--light');
    document.documentElement.classList.remove('theme--dark');
	document.getElementById("theme-toggle").className = 'dark';
	window.localStorage.setItem('theme', 'light');
}

if (theme === "dark") {
    activateDarkTheme();
} else if (theme === "light") {
    activateLightTheme();
} else if  (userPrefers === "light") {
    activateDarkTheme();
} else {
    activateDarkTheme();
}

function modeSwitcher() {
	let currentMode = document.documentElement.getAttribute('data-theme');
	if (currentMode === "dark") {
	    activateLightTheme();
	} else {
	    activateDarkTheme();
	}
}
</script></div>
  </div>
</footer>


<script>
      window.FontAwesomeConfig = {
        searchPseudoElements: true
      }
    </script>
  </body>

</html>

<!DOCTYPE html>
<html class="direction--ltr"lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>AWS Amplify Android ì˜¤í”ˆì†ŒìŠ¤ ê¸°ì—¬í•˜ê¸° | onseok.log</title>
<meta name="generator" content="Jekyll v4.4.1" />
<meta property="og:title" content="AWS Amplify Android ì˜¤í”ˆì†ŒìŠ¤ ê¸°ì—¬í•˜ê¸°" />
<meta name="author" content="onseok" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="AWS AmplifyëŠ” ëª¨ë°”ì¼ ë° í”„ëŸ°íŠ¸ì—”ë“œ ê°œë°œìê°€ AWSì—ì„œ ì•ˆì „í•˜ê³  í™•ì¥ ê°€ëŠ¥í•œ í’€ìŠ¤íƒ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ êµ¬ì¶•í•˜ê³  ë°°í¬í•  ìˆ˜ ìˆë„ë¡ ì§€ì›í•˜ëŠ” ì œí’ˆì…ë‹ˆë‹¤. íšŒì‚¬ì—ì„œ ì„œë¹„ìŠ¤í•˜ê³  ìˆëŠ” í”„ë¡œì íŠ¸ì—ì„œ S3ë¡œ ë¡œê·¸ íŒŒì¼ì„ ì£¼ê¸°ì ìœ¼ë¡œ ì—…ë¡œë“œí•˜ëŠ” ê¸°ëŠ¥ì„ êµ¬í˜„í•˜ê³  ê¾¸ì¤€íˆ ëª¨ë‹ˆí„°ë§í•˜ì˜€ëŠ”ë°, ì—¬ëŸ¬ Android ê¸°ê¸°ì—ì„œ java.lang.OutOfMemoryError ì˜¤ë¥˜ê°€ ë°˜ë³µì ìœ¼ë¡œ ë°œìƒí•˜ëŠ” ê²ƒì„ ë°œê²¬í–ˆìŠµë‹ˆë‹¤." />
<meta property="og:description" content="AWS AmplifyëŠ” ëª¨ë°”ì¼ ë° í”„ëŸ°íŠ¸ì—”ë“œ ê°œë°œìê°€ AWSì—ì„œ ì•ˆì „í•˜ê³  í™•ì¥ ê°€ëŠ¥í•œ í’€ìŠ¤íƒ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ êµ¬ì¶•í•˜ê³  ë°°í¬í•  ìˆ˜ ìˆë„ë¡ ì§€ì›í•˜ëŠ” ì œí’ˆì…ë‹ˆë‹¤. íšŒì‚¬ì—ì„œ ì„œë¹„ìŠ¤í•˜ê³  ìˆëŠ” í”„ë¡œì íŠ¸ì—ì„œ S3ë¡œ ë¡œê·¸ íŒŒì¼ì„ ì£¼ê¸°ì ìœ¼ë¡œ ì—…ë¡œë“œí•˜ëŠ” ê¸°ëŠ¥ì„ êµ¬í˜„í•˜ê³  ê¾¸ì¤€íˆ ëª¨ë‹ˆí„°ë§í•˜ì˜€ëŠ”ë°, ì—¬ëŸ¬ Android ê¸°ê¸°ì—ì„œ java.lang.OutOfMemoryError ì˜¤ë¥˜ê°€ ë°˜ë³µì ìœ¼ë¡œ ë°œìƒí•˜ëŠ” ê²ƒì„ ë°œê²¬í–ˆìŠµë‹ˆë‹¤." />
<link rel="canonical" href="https://onseok.github.io/2025/02/25/aws-amplify-android.html" />
<meta property="og:url" content="https://onseok.github.io/2025/02/25/aws-amplify-android.html" />
<meta property="og:site_name" content="onseok.log" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2025-02-25T00:00:00+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="AWS Amplify Android ì˜¤í”ˆì†ŒìŠ¤ ê¸°ì—¬í•˜ê¸°" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"onseok"},"dateModified":"2025-02-25T00:00:00+00:00","datePublished":"2025-02-25T00:00:00+00:00","description":"AWS AmplifyëŠ” ëª¨ë°”ì¼ ë° í”„ëŸ°íŠ¸ì—”ë“œ ê°œë°œìê°€ AWSì—ì„œ ì•ˆì „í•˜ê³  í™•ì¥ ê°€ëŠ¥í•œ í’€ìŠ¤íƒ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ êµ¬ì¶•í•˜ê³  ë°°í¬í•  ìˆ˜ ìˆë„ë¡ ì§€ì›í•˜ëŠ” ì œí’ˆì…ë‹ˆë‹¤. íšŒì‚¬ì—ì„œ ì„œë¹„ìŠ¤í•˜ê³  ìˆëŠ” í”„ë¡œì íŠ¸ì—ì„œ S3ë¡œ ë¡œê·¸ íŒŒì¼ì„ ì£¼ê¸°ì ìœ¼ë¡œ ì—…ë¡œë“œí•˜ëŠ” ê¸°ëŠ¥ì„ êµ¬í˜„í•˜ê³  ê¾¸ì¤€íˆ ëª¨ë‹ˆí„°ë§í•˜ì˜€ëŠ”ë°, ì—¬ëŸ¬ Android ê¸°ê¸°ì—ì„œ java.lang.OutOfMemoryError ì˜¤ë¥˜ê°€ ë°˜ë³µì ìœ¼ë¡œ ë°œìƒí•˜ëŠ” ê²ƒì„ ë°œê²¬í–ˆìŠµë‹ˆë‹¤.","headline":"AWS Amplify Android ì˜¤í”ˆì†ŒìŠ¤ ê¸°ì—¬í•˜ê¸°","mainEntityOfPage":{"@type":"WebPage","@id":"https://onseok.github.io/2025/02/25/aws-amplify-android.html"},"url":"https://onseok.github.io/2025/02/25/aws-amplify-android.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/style.css">
  <link rel="icon" type="image/png" href="/assets/favicon.png" />
  <link rel="stylesheet" href="/assets/css/magnific-popup.css"><link type="application/atom+xml" rel="alternate" href="https://onseok.github.io/feed.xml" title="onseok.log" /><script src="https://code.jquery.com/jquery-3.2.0.min.js"></script> 
  <script src="/assets/js/jquery.magnific-popup.js"></script>
</head>
<body><div class="site-header">
  <div class="wrapper">
    <a class="site-title" rel="author" href="/">onseok.log<b class="command_prompt"></b><b class="blinking_cursor">_</b></a>
    <span class="social_links">
        
        
        <a class="color-yellow-hover" href="https://github.com/onseok"><i class="fab fa-github-square"></i></a>
        
        
        
        <a class="color-blue-hover" href="https://www.linkedin.com/in/onseok"><i class="fab fa-linkedin"></i></a>
        
        
    </span>
  </div>
</div>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        
  <div class="author-box">


<img src="
    https://github.com/onseok.png
" class="author-avatar" alt="Avatar" />
<div class="description">ìƒê°ì„ ì»´íŒŒì¼í•˜ê¸°<br>
ë°°ì›€ì„ ë°°í¬í•˜ê¸°
</div>

</div>


<div class="post">
  <h1 class="post-title">AWS Amplify Android ì˜¤í”ˆì†ŒìŠ¤ ê¸°ì—¬í•˜ê¸°</h1>
  
  <div class="post-tags">
      
      <a class="tag" href="/tag/opensource/">opensource</a>
      
  </div>
  
  <div class="post-date">
    Published on 25 Feb 2025
    
  </div>
  
  <p>AWS AmplifyëŠ” ëª¨ë°”ì¼ ë° í”„ëŸ°íŠ¸ì—”ë“œ ê°œë°œìê°€ AWSì—ì„œ ì•ˆì „í•˜ê³  í™•ì¥ ê°€ëŠ¥í•œ í’€ìŠ¤íƒ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ êµ¬ì¶•í•˜ê³  ë°°í¬í•  ìˆ˜ ìˆë„ë¡ ì§€ì›í•˜ëŠ” ì œí’ˆì…ë‹ˆë‹¤. íšŒì‚¬ì—ì„œ ì„œë¹„ìŠ¤í•˜ê³  ìˆëŠ” í”„ë¡œì íŠ¸ì—ì„œ S3ë¡œ ë¡œê·¸ íŒŒì¼ì„ ì£¼ê¸°ì ìœ¼ë¡œ ì—…ë¡œë“œí•˜ëŠ” ê¸°ëŠ¥ì„ êµ¬í˜„í•˜ê³  ê¾¸ì¤€íˆ ëª¨ë‹ˆí„°ë§í•˜ì˜€ëŠ”ë°, ì—¬ëŸ¬ Android ê¸°ê¸°ì—ì„œ <a href="https://docs.oracle.com/javase/8/docs/technotes/guides/troubleshoot/memleaks002.html">java.lang.OutOfMemoryError</a> ì˜¤ë¥˜ê°€ ë°˜ë³µì ìœ¼ë¡œ ë°œìƒí•˜ëŠ” ê²ƒì„ ë°œê²¬í–ˆìŠµë‹ˆë‹¤.</p>

<h3 id="ì›ì¸ì„-ë¶„ì„í•´ë³´ì">ì›ì¸ì„ ë¶„ì„í•´ë³´ì</h3>
<p>ìˆ˜ì§‘ëœ í¬ë˜ì‹œ ë¦¬í¬íŠ¸ë¥¼ ìš”ì•½í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì•˜ìŠµë‹ˆë‹¤.</p>
<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Fatal Exception: java.lang.OutOfMemoryError: Failed to allocate a 8388620 byte allocation with 8388608 free bytes and 19MB until OOM
       at java.util.IdentityHashMap.resize(IdentityHashMap.java:476)
       at java.util.IdentityHashMap.put(IdentityHashMap.java:452)
       ...
       at com.amplifyframework.storage.s3.transfer.TransferWorkerObserver$attachObserver$2.invokeSuspend(TransferWorkerObserver.kt:199)
</code></pre></div></div>

<p><a href="https://github.com/aws-amplify/amplify-android/blob/main/aws-storage-s3/src/main/java/com/amplifyframework/storage/s3/transfer/TransferWorkerObserver.kt">TransferWorkerObserver</a> í´ë˜ìŠ¤ì—ì„œ ë™ì¼í•œ ì „ì†¡ íƒœê·¸ì— ëŒ€í•´ <code class="language-plaintext highlighter-rouge">LiveData.observeForever()</code>ê°€ ì¤‘ë³µ í˜¸ì¶œë˜ë©°, ì—¬ëŸ¬ ê´€ì°°ìê°€ ë“±ë¡ëœ ê²ƒìœ¼ë¡œ ë³´ì˜€ê³ , ì´ëŠ” <code class="language-plaintext highlighter-rouge">LiveData</code> ë‚´ë¶€ì˜ <a href="https://docs.oracle.com/javase/8/docs/api/java/util/IdentityHashMap.html">IdentityHashMap</a>ì´ ê³¼ë„í•˜ê²Œ ì»¤ì ¸ ë©”ëª¨ë¦¬ í• ë‹¹ì— ì‹¤íŒ¨í•˜ê²Œ ë§Œë“¤ê³ , íŠ¹íˆ <code class="language-plaintext highlighter-rouge">Room</code> ë¼ì´ë¸ŒëŸ¬ë¦¬ì˜ <a href="https://developer.android.com/reference/androidx/room/InvalidationTracker">InvalidationTracker</a>ì™€ ì—°ê³„ëœ <code class="language-plaintext highlighter-rouge">LiveData</code> ì‚¬ìš©ìœ¼ë¡œ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ì´ ë” ì¦ê°€í•œ ê²ƒìœ¼ë¡œ íŒë‹¨í•˜ì˜€ìŠµë‹ˆë‹¤.</p>

<h3 id="ì´ìŠˆ-ë“±ë¡í•˜ê¸°">ì´ìŠˆ ë“±ë¡í•˜ê¸°</h3>
<p>ì €ëŠ” ë¨¼ì € ì´ ë¬¸ì œë¥¼ ê³µìœ í•˜ê¸° ìœ„í•´ í…œí”Œë¦¿ì— ë§ì¶”ì–´ <a href="https://github.com/aws-amplify/amplify-android/issues/2840">ì´ìŠˆ</a>ë¥¼ ë“±ë¡í•´ì£¼ì—ˆìŠµë‹ˆë‹¤.</p>

<p>ë‹¤ë§Œ, <strong>ë³´ì•ˆìƒ</strong> íšŒì‚¬ ì½”ë“œë¥¼ ì „ë¶€ ìŠ¤ë‹ˆí«ì— ì²¨ë¶€í•  ìˆ˜ëŠ” ì—†ì—ˆê¸° ë•Œë¬¸ì— ë¯¼ê°í•œ ì½”ë“œëŠ” ì „ë¶€ ì œê±°í•˜ê³  í•µì‹¬ ë¡œì§ë§Œ ë‹¤ì‹œ ì¬ì‘ì„±í•˜ì˜€ìŠµë‹ˆë‹¤. ì´ìŠˆë€ì— ì²¨ë¶€í•œ ì½”ë“œ ìŠ¤ë‹ˆí«ì€ ë‹¤ìŒê³¼ ê°™ì•˜ìŠµë‹ˆë‹¤.</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@HiltWorker</span>
<span class="kd">class</span> <span class="nc">LogUploadWorker</span> <span class="nd">@AssistedInject</span> <span class="k">constructor</span><span class="p">(</span>
    <span class="nd">@Assisted</span> <span class="k">private</span> <span class="kd">val</span> <span class="py">appContext</span><span class="p">:</span> <span class="nc">Context</span><span class="p">,</span>
    <span class="nd">@Assisted</span> <span class="n">workerParams</span><span class="p">:</span> <span class="nc">WorkerParameters</span><span class="p">,</span>
    <span class="nd">@Dispatcher</span><span class="p">(</span><span class="nc">IO</span><span class="p">)</span> <span class="k">private</span> <span class="kd">val</span> <span class="py">ioDispatcher</span><span class="p">:</span> <span class="nc">CoroutineDispatcher</span>
<span class="p">)</span> <span class="p">:</span> <span class="nc">CoroutineWorker</span><span class="p">(</span><span class="n">appContext</span><span class="p">,</span> <span class="n">workerParams</span><span class="p">)</span> <span class="p">{</span>

    <span class="k">override</span> <span class="k">suspend</span> <span class="k">fun</span> <span class="nf">getForegroundInfo</span><span class="p">():</span> <span class="nc">ForegroundInfo</span> <span class="p">=</span>
        <span class="n">appContext</span><span class="p">.</span><span class="nf">logSyncForegroundInfo</span><span class="p">()</span>

    <span class="k">override</span> <span class="k">suspend</span> <span class="k">fun</span> <span class="nf">doWork</span><span class="p">():</span> <span class="nc">Result</span> <span class="p">=</span> <span class="nf">withContext</span><span class="p">(</span><span class="n">ioDispatcher</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">try</span> <span class="p">{</span>
            <span class="kd">val</span> <span class="py">externalFilesDirPath</span> <span class="p">=</span> <span class="n">inputData</span><span class="p">.</span><span class="nf">getString</span><span class="p">(</span><span class="s">"externalFilesDirPath"</span><span class="p">)</span>
            <span class="kd">val</span> <span class="py">externalFilesDir</span> <span class="p">=</span> <span class="n">externalFilesDirPath</span><span class="o">?.</span><span class="nf">let</span> <span class="p">{</span> <span class="nc">File</span><span class="p">(</span><span class="n">it</span><span class="p">)</span> <span class="p">}</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">externalFilesDir</span> <span class="p">!=</span> <span class="k">null</span> <span class="p">&amp;&amp;</span> <span class="n">externalFilesDir</span><span class="p">.</span><span class="nf">exists</span><span class="p">())</span> <span class="p">{</span>
                <span class="nf">uploadLogFiles</span><span class="p">(</span><span class="n">externalFilesDir</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">e</span><span class="p">:</span> <span class="nc">Exception</span><span class="p">)</span> <span class="p">{</span>
            <span class="nc">Timber</span><span class="p">.</span><span class="nf">e</span><span class="p">(</span><span class="s">"Log upload exception: ${e.message}"</span><span class="p">)</span>
            <span class="nc">Result</span><span class="p">.</span><span class="nf">retry</span><span class="p">()</span>
        <span class="p">}</span>
        <span class="nc">Result</span><span class="p">.</span><span class="nf">success</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="nd">@OptIn</span><span class="p">(</span><span class="nc">ExperimentalCoroutinesApi</span><span class="o">::</span><span class="k">class</span><span class="p">,</span> <span class="nc">FlowPreview</span><span class="o">::</span><span class="k">class</span><span class="p">)</span>
    <span class="k">private</span> <span class="k">suspend</span> <span class="k">fun</span> <span class="nf">uploadLogFiles</span><span class="p">(</span><span class="n">externalFilesDir</span><span class="p">:</span> <span class="nc">File</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">val</span> <span class="py">curFiles</span> <span class="p">=</span> <span class="n">externalFilesDir</span><span class="p">.</span><span class="nf">listFiles</span><span class="p">()</span><span class="o">?.</span><span class="nf">filter</span> <span class="p">{</span> <span class="n">file</span> <span class="p">-&gt;</span>
            <span class="nc">System</span><span class="p">.</span><span class="nf">currentTimeMillis</span><span class="p">()</span> <span class="p">-</span> <span class="n">file</span><span class="p">.</span><span class="nf">lastModified</span><span class="p">()</span> <span class="p">&lt;</span> <span class="nc">TWO_WEEK_TIME_MILLIS</span>
        <span class="p">}</span><span class="o">?.</span><span class="nf">sortedByDescending</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="nf">lastModified</span><span class="p">()</span> <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">curFiles</span><span class="p">.</span><span class="nf">isNullOrEmpty</span><span class="p">())</span> <span class="p">{</span>
            <span class="nc">Timber</span><span class="p">.</span><span class="nf">i</span><span class="p">(</span><span class="s">"No log files or directory found."</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="p">}</span>
        
        <span class="kd">val</span> <span class="py">environmentPrefix</span> <span class="p">=</span> <span class="k">if</span> <span class="p">(</span><span class="nc">BuildConfig</span><span class="p">.</span><span class="nc">DEBUG</span><span class="p">)</span> <span class="s">"debug"</span> <span class="k">else</span> <span class="s">"release"</span>
        <span class="kd">val</span> <span class="py">dateFormat</span> <span class="p">=</span> <span class="nc">SimpleDateFormat</span><span class="p">(</span><span class="s">"yyyy-MM-dd"</span><span class="p">,</span> <span class="nc">Locale</span><span class="p">.</span><span class="nf">getDefault</span><span class="p">())</span>

        <span class="n">curFiles</span><span class="p">.</span><span class="nf">forEach</span> <span class="p">{</span> <span class="n">file</span> <span class="p">-&gt;</span>
            <span class="kd">val</span> <span class="py">date</span> <span class="p">=</span> <span class="n">dateFormat</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="nc">Date</span><span class="p">(</span><span class="n">file</span><span class="p">.</span><span class="nf">lastModified</span><span class="p">()))</span>
            <span class="kd">val</span> <span class="py">fileIndex</span> <span class="p">=</span> <span class="n">file</span><span class="p">.</span><span class="n">name</span><span class="p">.</span><span class="nf">substringBefore</span><span class="p">(</span><span class="s">"_logs.txt"</span><span class="p">).</span><span class="nf">takeLastWhile</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="nf">isDigit</span><span class="p">()</span> <span class="p">}</span>
            <span class="kd">val</span> <span class="py">key</span> <span class="p">=</span> <span class="s">"$environmentPrefix/sample/$date/log$fileIndex.txt"</span>

            <span class="k">try</span> <span class="p">{</span>
                <span class="kd">val</span> <span class="py">result</span> <span class="p">=</span> <span class="nc">Amplify</span><span class="p">.</span><span class="nc">Storage</span><span class="p">.</span><span class="nf">uploadFile</span><span class="p">(</span>
                    <span class="nc">StoragePath</span><span class="p">.</span><span class="nf">fromString</span><span class="p">(</span><span class="s">"public/$key"</span><span class="p">),</span>
                    <span class="n">file</span>
                <span class="p">).</span><span class="nf">result</span><span class="p">()</span>
                <span class="nc">Timber</span><span class="p">.</span><span class="nf">i</span><span class="p">(</span><span class="s">"Log file upload successful: ${result.path}"</span><span class="p">)</span>
            <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">error</span><span class="p">:</span> <span class="nc">Exception</span><span class="p">)</span> <span class="p">{</span>
                <span class="nc">Timber</span><span class="p">.</span><span class="nf">e</span><span class="p">(</span><span class="s">"Log file upload failed: ${error.message} - ${error.cause}"</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">companion</span> <span class="k">object</span> <span class="p">{</span>
        <span class="k">private</span> <span class="k">const</span> <span class="kd">val</span> <span class="py">TWO_WEEK_TIME_MILLIS</span> <span class="p">=</span> <span class="mi">14</span> <span class="p">*</span> <span class="mi">24</span> <span class="p">*</span> <span class="mi">60</span> <span class="p">*</span> <span class="mi">60</span> <span class="p">*</span> <span class="mi">1000L</span>

        <span class="k">fun</span> <span class="nf">startUpUploadWork</span><span class="p">(</span>
            <span class="n">externalFilesDirPath</span><span class="p">:</span> <span class="nc">File</span><span class="p">?</span>
        <span class="p">)</span> <span class="p">=</span> <span class="nc">PeriodicWorkRequestBuilder</span><span class="p">&lt;</span><span class="nc">LogUploadWorker</span><span class="p">&gt;(</span>
            <span class="mi">1</span><span class="p">,</span> <span class="nc">TimeUnit</span><span class="p">.</span><span class="nc">HOURS</span><span class="p">,</span>
            <span class="mi">5</span><span class="p">,</span> <span class="nc">TimeUnit</span><span class="p">.</span><span class="nc">MINUTES</span>
        <span class="p">)</span>
            <span class="p">.</span><span class="nf">setConstraints</span><span class="p">(</span><span class="nc">LogSyncConstraints</span><span class="p">)</span>
            <span class="p">.</span><span class="nf">setBackoffCriteria</span><span class="p">(</span>
                <span class="nc">BackoffPolicy</span><span class="p">.</span><span class="nc">LINEAR</span><span class="p">,</span>
                <span class="nc">MIN_BACKOFF_MILLIS</span><span class="p">,</span>
                <span class="nc">TimeUnit</span><span class="p">.</span><span class="nc">MILLISECONDS</span>
            <span class="p">)</span>
            <span class="p">.</span><span class="nf">setInputData</span><span class="p">(</span>
                <span class="nc">Data</span><span class="p">.</span><span class="nc">Builder</span><span class="p">()</span>
                    <span class="p">.</span><span class="nf">putString</span><span class="p">(</span><span class="s">"externalFilesDirPath"</span><span class="p">,</span> <span class="n">externalFilesDirPath</span><span class="o">?.</span><span class="n">absolutePath</span><span class="p">)</span>
                    <span class="p">.</span><span class="nf">build</span><span class="p">()</span>
            <span class="p">)</span>
            <span class="p">.</span><span class="nf">build</span><span class="p">()</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>ê°„ë‹¨í•˜ê²Œ ìœ„ ìŠ¤ë‹ˆí«ì˜ ë¡œì§ì„ ì„¤ëª…í•˜ë©´, ë¨¼ì € ë¡œê·¸ íŒŒì¼ ë””ë ‰í„°ë¦¬ ê²½ë¡œë¥¼ ê¸°ë°˜ìœ¼ë¡œ íŒŒì¼ ê°ì²´ë¥¼ ìƒì„±í•˜ê³ , <strong>2ì£¼</strong> ì´ë‚´ì— ìˆ˜ì •ëœ íŒŒì¼ë“¤ì„ í•„í„°ë§í•˜ë©°, ìµœê·¼ ìˆ˜ì •ëœ ìˆœì„œë¡œ ì •ë ¬í•œ ë’¤, ì˜ˆì™¸ê°€ ë°œìƒí–ˆì„ ë•Œì—ëŠ” <code class="language-plaintext highlighter-rouge">ì„ í˜• ì¬ì‹œë„</code> ì •ì±…ì„ ë”°ë¥´ë„ë¡ ì„¤ì •í•´ì£¼ì—ˆê³ , ê° íŒŒì¼ì— ëŒ€í•´ <code class="language-plaintext highlighter-rouge">ë¹Œë“œíƒ€ì…</code>ì— ë”°ë¥¸ ì •ë³´ì™€, íŒŒì¼ì˜ ìˆ˜ì • ë‚ ì§œ, íŒŒì¼ ì´ë¦„ì˜ ì¸ë±ìŠ¤ë¥¼ ì¡°í•©í•˜ì—¬ AWS S3ì— ì €ì¥í•  í‚¤ë¥¼ êµ¬ì„±í•˜ê³ , ì´í›„ íŒŒì¼ì„ ì—…ë¡œë“œí•˜ê³  ê·¸ ê²°ê³¼ë¥¼ Timber ë¡œê·¸ë¡œ ë‚¨ê¸°ëŠ” íë¦„ì…ë‹ˆë‹¤. ì´ ì‘ì—…ì€ <code class="language-plaintext highlighter-rouge">ì£¼ê¸°ì ìœ¼ë¡œ ì‹¤í–‰ë˜ëŠ” ì‘ì—…</code>ì— í•´ë‹¹í•˜ë¯€ë¡œ <a href="https://developer.android.com/topic/libraries/architecture/workmanager?hl=ko">Workmanager</a>ì˜ <a href="https://developer.android.com/reference/androidx/work/PeriodicWorkRequest.Builder">PeriodicWorkRequest.Builder</a>ë¥¼ í™œìš©í•˜ì˜€ìŠµë‹ˆë‹¤.</p>

<p><img src="/public/media/2025-02-25/aws-amplify-issue-comment.png" alt="aws-amplify-issue-comment" /></p>

<p>ì´í›„ í•´ë‹¹ ì´ìŠˆë€ì˜ ì½”ë©˜íŠ¸ë¥¼ í†µí•´ ë©”ì¸í…Œì´ë„ˆë¶„ë“¤ê³¼ ì´ìŠˆì˜ ë°œìƒ ë¹ˆë„ì™€ ë¬¸ì œ ë°œìƒ ê¸°ê¸°ì˜ ìŠ¤í™ ì •ë³´ë“¤ì„ ìš”ì²­ë°›ì•˜ê³ , ë‹¹ì‹œì—ëŠ” <a href="https://github.com/aws-amplify/amplify-android">aws-amplify/amplify-android</a> ë¼ì´ë¸ŒëŸ¬ë¦¬ ìì²´ì˜ ë¬¸ì œë¼ê¸°ë³´ë‹¤ëŠ” <code class="language-plaintext highlighter-rouge">ë‚´ê°€ êµ¬í˜„í•œ ì½”ë“œì— ë¬¸ì œê°€ ìˆì—ˆë‚˜?</code>, <code class="language-plaintext highlighter-rouge">OOMì´ ë°œìƒí•˜ì§€ ì•Šë„ë¡ ë” ìµœì í™” í• ìˆ˜ëŠ” ì—†ëŠ”ê°€?</code>ë¼ê³  ê³ ë¯¼ì„ í•˜ì˜€ê³ , ì´ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ ì•„ë˜ì˜ ê°œì„ ì‘ì—…ë“¤ì„ ì§„í–‰í–ˆìŠµë‹ˆë‹¤.</p>

<ul>
  <li>ë¡œê·¸ íŒŒì¼ ë¦¬ìŠ¤íŠ¸ë¥¼ ì¦‰ì‹œ ëª¨ë‘ ë©”ëª¨ë¦¬ì— ë¡œë“œí•˜ì§€ ì•Šê³ , í•„ìš”í•œ ì‹œì ì—ë§Œ File ê°ì²´ë¥¼ ìƒì„±í•˜ë„ë¡ ê°œì„ í•˜ê¸°</li>
  <li>14ì¼ ì´ìƒëœ ì˜¤ë˜ëœ ë¡œê·¸ íŒŒì¼ë“¤ì„ ì£¼ê¸°ì ìœ¼ë¡œ ì‚­ì œí•˜ì—¬ ì²˜ë¦¬í•´ì•¼í•  ë¡œê·¸ íŒŒì¼ ìˆ˜ ìì²´ë¥¼ ì¤„ì´ê¸°</li>
</ul>

<p>í•˜ì§€ë§Œ, ì´ëŸ¬í•œ ë…¸ë ¥ì—ë„ ë¶ˆêµ¬í•˜ê³  ì—¬ì „íˆ ì£¼ê¸°ì ìœ¼ë¡œ OOM ì˜¤ë¥˜ë“¤ì´ ìˆ˜ì§‘ë˜ì—ˆìŠµë‹ˆë‹¤.</p>

<h3 id="ì§ì ‘-ìˆ˜ì •í•´ë³´ì">ì§ì ‘ ìˆ˜ì •í•´ë³´ì</h3>
<p>ì˜¤í”ˆì†ŒìŠ¤ì™€ ê´€ë ¨ëœ í™œë™ì„ í•œë‹¤ë©´, ë¼ì´ì„ ìŠ¤ ê·œì •ì„ ì˜ ì¤€ìˆ˜í•´ì•¼ í•©ë‹ˆë‹¤. ë˜í•œ ì˜¤í”ˆì†ŒìŠ¤ í”„ë¡œì íŠ¸ì— ì»¨íŠ¸ë¦¬ë·°ì…˜ì„ í•˜ê¸° ì „ì—ëŠ” <code class="language-plaintext highlighter-rouge">CONTRIBUTING.md</code> íŒŒì¼ì„ ê¼¼ê¼¼í•˜ê²Œ ì½ì–´ ê°€ì´ë“œë¼ì¸ì„ ì˜ ì¤€ìˆ˜í•  ìˆ˜ ìˆë„ë¡ í•´ì•¼í•©ë‹ˆë‹¤.</p>

<p>ì €ëŠ” ì§ì ‘ ìˆ˜ì •í•´ë³´ê¸°ë¡œ ë§ˆìŒë¨¹ì—ˆìŠµë‹ˆë‹¤. ìˆ˜ì§‘ëœ í¬ë˜ì‹œ ë¦¬í¬íŠ¸ë¥¼ ë‹¤ì‹œ ë¶„ì„í•˜ì—¬ ì½”ë“œë¥¼ ìˆ˜ì •í•œ ë’¤ PRì„ ìƒì„±í•˜ì˜€ê³ , ìˆ˜ì •ëœ ì½”ë“œëŠ” ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">java.util.concurrent.ConcurrentHashMap</span>

<span class="k">private</span> <span class="kd">val</span> <span class="py">observedTags</span> <span class="p">=</span> <span class="nc">ConcurrentHashMap</span><span class="p">.</span><span class="n">newKeySet</span><span class="p">&lt;</span><span class="nc">String</span><span class="p">&gt;()</span>

<span class="k">private</span> <span class="k">suspend</span> <span class="k">fun</span> <span class="nf">attachObserver</span><span class="p">(</span><span class="n">tag</span><span class="p">:</span> <span class="nc">String</span><span class="p">)</span> <span class="p">{</span>
    <span class="nf">withContext</span><span class="p">(</span><span class="nc">Dispatchers</span><span class="p">.</span><span class="nc">Main</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(!</span><span class="n">observedTags</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="n">tag</span><span class="p">))</span> <span class="k">return</span><span class="nd">@withContext</span>
        <span class="kd">val</span> <span class="py">liveData</span> <span class="p">=</span> <span class="n">workManager</span><span class="p">.</span><span class="nf">getWorkInfosByTagLiveData</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
        <span class="n">liveData</span><span class="p">.</span><span class="nf">observeForever</span><span class="p">(</span><span class="k">this</span><span class="nd">@TransferWorkerObserver</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">private</span> <span class="k">suspend</span> <span class="k">fun</span> <span class="nf">removeObserver</span><span class="p">(</span><span class="n">tag</span><span class="p">:</span> <span class="nc">String</span><span class="p">)</span> <span class="p">{</span>
    <span class="nf">withContext</span><span class="p">(</span><span class="nc">Dispatchers</span><span class="p">.</span><span class="nc">Main</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(!</span><span class="n">observedTags</span><span class="p">.</span><span class="nf">remove</span><span class="p">(</span><span class="n">tag</span><span class="p">))</span> <span class="k">return</span><span class="nd">@withContext</span>
        <span class="n">workManager</span><span class="p">.</span><span class="nf">getWorkInfosByTagLiveData</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
            <span class="p">.</span><span class="nf">removeObserver</span><span class="p">(</span><span class="k">this</span><span class="nd">@TransferWorkerObserver</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>AWS Amplify Storage ëª¨ë“ˆì˜ <a href="https://github.com/aws-amplify/amplify-android/blob/main/aws-storage-s3/src/main/java/com/amplifyframework/storage/s3/transfer/TransferWorkerObserver.kt">TransferWorkerObserver</a> í´ë˜ìŠ¤ì— ì¤‘ë³µ ê´€ì°°ì ë“±ë¡ì„ ë°©ì§€í•˜ëŠ” ë¡œì§ì„ ì¶”ê°€í•˜ì˜€ê³ , <a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/ConcurrentHashMap.html">ConcurrentHashMap</a>ì€ <code class="language-plaintext highlighter-rouge">thread-safe</code>í•˜ë©°, <code class="language-plaintext highlighter-rouge">ConcurrentHashMap.newKeySet()</code>ì€ <code class="language-plaintext highlighter-rouge">Set</code> ì¸í„°í˜ì´ìŠ¤ë¥¼ ì œê³µí•´ì£¼ëŠ”ë°, íƒœê·¸ê°€ ì´ë¯¸ ì¡´ì¬í•˜ë©´ <code class="language-plaintext highlighter-rouge">add()</code>ëŠ” <code class="language-plaintext highlighter-rouge">false</code>ë¥¼ ë°˜í™˜í•˜ê³ , ì–¼ë¦¬ ë¦¬í„´ì„ í†µí•´ í•¨ìˆ˜ë¥¼ ì¢…ë£Œí•©ë‹ˆë‹¤. ë§ˆì°¬ê°€ì§€ë¡œ <code class="language-plaintext highlighter-rouge">remove()</code>ëŠ” íƒœê·¸ê°€ <code class="language-plaintext highlighter-rouge">observedTags</code>ì— ì—†ìœ¼ë©´ falseë¥¼ ë°˜í™˜í•˜ê³  í•¨ìˆ˜ë¥¼ ì¢…ë£Œì‹œí‚µë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ë¶ˆí•„ìš”í•œ ì¤‘ë³µëœ íƒœê·¸ ë“±ë¡ì„ ë°©ì§€í•  ìˆ˜ ìˆë„ë¡ ìˆ˜ì •í•˜ì˜€ìŠµë‹ˆë‹¤.</p>

<h3 id="ë¿Œë“¯í•œ-ê²°ê³¼">ë¿Œë“¯í•œ ê²°ê³¼</h3>
<p><img src="/public/media/2025-02-25/aws-amplify-approve-comment.png" alt="aws-amplify-approve-comment" /></p>

<p>ë©”ì¸í…Œì´ë„ˆë¶„ìœ¼ë¡œë¶€í„° ì¢‹ì€ ì•„ì´ë””ì–´ë¼ëŠ” ì˜ê²¬ê³¼ í•¨ê»˜ ëª‡ ê°€ì§€ ì œì•ˆì‚¬í•­ë“¤ì„ ìˆ˜ì •í•œ ë’¤ì— ìµœì¢… ìŠ¹ì¸ì´ ë˜ì—ˆê³ , <a href="https://github.com/aws-amplify/amplify-android/releases/tag/release_v2.27.1">2.27.1</a> ë²„ì „ì— í•´ë‹¹ ì‘ì—…ì´ ë°˜ì˜ë˜ì–´ ë¦´ë¦¬ì¦ˆ ë˜ì—ˆìŠµë‹ˆë‹¤ ğŸ‰</p>

<p>ì´ëŸ¬í•œ ê²½í—˜ì„ í†µí•´ì„œ íšŒì‚¬ í”„ë¡œì íŠ¸ì—ì„œ ì‚¬ìš©ì¤‘ì¸ ì˜¤í”ˆì†ŒìŠ¤ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì˜¤ë¥˜ë¥¼ ë°œê²¬í•˜ë©´ ì ê·¹ì ìœ¼ë¡œ PRì„ ì˜¬ë ¤ ê¸°ì—¬í•˜ê³  ë¬¸ì œë¥¼ ìˆ˜ì •í•˜ëŠ” ê²ƒì´ ì¤‘ìš”í•˜ë‹¤ê³  ëŠê¼ˆê³ , ìì£¼ ì‚¬ìš©í–ˆì§€ë§Œ ëª°ëë˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ì˜ ë‚´ë¶€ ë™ì‘ì„ ì‚´í´ë³´ëŠ” ê²½í—˜ì„ í•˜ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.</p>

<h3 id="ì•„ì‰¬ì› ë˜-ì -ê·¸ë¦¬ê³ -ë°˜ì„±">ì•„ì‰¬ì› ë˜ ì , ê·¸ë¦¬ê³  ë°˜ì„±</h3>

<blockquote>
  <p>ë§Œì•½ Heap Dumpë¥¼ ë”ìš± ëˆì§ˆê¸°ê²Œ ë¶„ì„í–ˆë”ë¼ë©´, ë¬¸ì œì˜ ê·¼ë³¸ ì›ì¸ì„ ë” ë¹ ë¥´ê²Œ íŒŒì•…í•˜ê³  ë³´ë‹¤ ë” ê·¼ê±°ìˆëŠ” ì´ìŠˆ íŠ¸ë˜í‚¹ì— í° ë„ì›€ì´ ë˜ì—ˆì§€ ì•Šì•˜ì„ê¹Œ?</p>
</blockquote>

</div>

<div class="comments">
    <script src="https://utteranc.es/client.js"
            repo="onseok/onseok.github.io"
            issue-term="pathname"
            theme="dark-blue"
            crossorigin="anonymous"
            async>
    </script>
  </div>






  
  <h2>all tags</h2>
  <div class="tag-cloud"><a href="/tag/opensource/" class="set-5">opensource</a></div>
  




<script>
  let i = 0;
  const text = '';
  const speed = parseInt('50');
  
  function typeWriter() {
    if (i < text.length) {
      document.getElementById('animated-post-description').innerHTML += text.charAt(i);
      i++;
      setTimeout(typeWriter, speed);
    }
  }

  document.getElementById('animated-post-description').style.display = 'initial';
  typeWriter();

  // Image modal
  var $imgs = [];
  $('img').each(function(idx) {
    var obj = {
      src: $(this).attr('src')
    }
    $imgs.push(obj);
    var elem = $(this);
    $(this).click(function() {
      $('.modal').magnificPopup('open', idx);
    });
  });

  $('.modal').magnificPopup({
    items: $imgs,
    type: 'image',
    closeOnContentClick: true,
    mainClass: 'mfp-img-mobile',
    image: {
      verticalFit: true
    }
    
  });
</script>
      </div>
    </main><footer class="site-footer">
  <div class="wrapper">
    <div class="credits"><a href="https://github.com/bitbrain/jekyll-dash">dash</a> theme for Jekyll by <a href="https://github.com/bitbrain">bitbrain</a> made with <i class="fas fa-heart"></i><div class="toggleWrapper">
    <input type="checkbox" class="dn" id="theme-toggle" onclick="modeSwitcher()" checked />
    <label for="theme-toggle" class="toggle">
    <span class="toggle__handler">
      <span class="crater crater--1"></span>
      <span class="crater crater--2"></span>
      <span class="crater crater--3"></span>
    </span>
        <span class="star star--1"></span>
        <span class="star star--2"></span>
        <span class="star star--3"></span>
        <span class="star star--4"></span>
        <span class="star star--5"></span>
        <span class="star star--6"></span>
    </label>
</div>
<script type="text/javascript">
const theme = localStorage.getItem('theme');

if (theme === "light") {
    document.documentElement.setAttribute('data-theme', 'light');
} else {
    document.documentElement.setAttribute('data-theme', 'dark');
}
const userPrefers = getComputedStyle(document.documentElement).getPropertyValue('content');

function activateDarkTheme() {
    document.getElementById('theme-toggle').checked = true;
    document.documentElement.setAttribute('data-theme', 'dark');
    document.documentElement.classList.add('theme--dark');
    document.documentElement.classList.remove('theme--light');
	document.getElementById("theme-toggle").className = 'light';
	window.localStorage.setItem('theme', 'dark');
}

function activateLightTheme() {
    document.getElementById('theme-toggle').checked = false;
    document.documentElement.setAttribute('data-theme', 'light');
    document.documentElement.classList.add('theme--light');
    document.documentElement.classList.remove('theme--dark');
	document.getElementById("theme-toggle").className = 'dark';
	window.localStorage.setItem('theme', 'light');
}

if (theme === "dark") {
    activateDarkTheme();
} else if (theme === "light") {
    activateLightTheme();
} else if  (userPrefers === "light") {
    activateDarkTheme();
} else {
    activateDarkTheme();
}

function modeSwitcher() {
	let currentMode = document.documentElement.getAttribute('data-theme');
	if (currentMode === "dark") {
	    activateLightTheme();
	} else {
	    activateDarkTheme();
	}
}
</script></div>
  </div>
</footer>


<script>
      window.FontAwesomeConfig = {
        searchPseudoElements: true
      }
    </script>
  </body>

</html>
